# ngx_pagespeed settings for Magento edge layer
pagespeed on;
pagespeed FileCachePath /var/cache/nginx/pagespeed;
pagespeed FileCacheSizeKb 1048576;
pagespeed FileCacheCleanIntervalMs 3600000;
pagespeed XHeaderValue "Powered By ngx_pagespeed";
pagespeed Statistics off;
pagespeed StatisticsLogging off;
pagespeed EnableCachePurge on;
pagespeed PurgeMethod PURGE;
pagespeed RewriteLevel CoreFilters;
pagespeed EnableFilters lazyload_images,inline_css,combine_css,combine_javascript,defer_javascript,extend_cache;
pagespeed DisableFilters convert_png_to_jpeg,convert_jpeg_to_webp;
pagespeed PreserveUrlRelativity on;
pagespeed RespectVary on;
pagespeed FetchHttps enable;

# Serve optimized assets / beacons
location ~ "\\.pagespeed\\.([a-z]\\.)?[a-z]{2}\\.[^.]{10}\\.[^\\.]+" {
    add_header "" "";
}
location ~ "^/ngx_pagespeed_beacon$" {}
location ~ "^/ngx_pagespeed_statistics$" {
    allow 127.0.0.1;
    deny all;
}
location ~ "^/ngx_pagespeed_global_statistics$" {
    allow 127.0.0.1;
    deny all;
}
location ~ "^/ngx_pagespeed_message$" {
    allow 127.0.0.1;
    deny all;
}
location ~ "^/pagespeed_console$" {
    allow 127.0.0.1;
    deny all;
}
location ~ "^/pagespeed_admin$" {
    allow 127.0.0.1;
    deny all;
}
location ~ "^/pagespeed_static/" {
    allow all;
}
location ~ "^/ngx_pagespeed_static/" {
    allow all;
}
