image:
  web:
    repository: registry.example.com/kubemage/magento-web
    tag: latest
  php:
    repository: registry.example.com/kubemage/magento-php-fpm
    tag: latest
  cron:
    repository: registry.example.com/kubemage/magento-cron
    tag: latest
  varnish:
    repository: docker.io/library/varnish
    tag: 7.6
  pullPolicy: IfNotPresent

replicaCount:
  web: 2
  php: 2
  varnish: 2

service:
  type: ClusterIP
  port: 8080

varnish:
  enabled: true
  replicaCount: 2
  serviceName: varnish
  servicePort: 6081
  backendPort: 8080
  storage: "512m"
  extraEnv: {}
  configSecret: ""
  purgeCIDRs:
    - 10.0.0.0/8

resources:
  web:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 2Gi
  php:
    requests:
      cpu: 1
      memory: 2Gi
    limits:
      cpu: 4
      memory: 4Gi
  cron:
    requests:
      cpu: 200m
      memory: 512Mi
  varnish:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi

env:
  baseUrl: https://store.example.com
  mediaBucket: s3://store-media
  rabbitmqHost: magento-mq.messaging.svc
  redisHost: valkey.cache.svc
  mysqlHost: magento-db-pxc.databases.svc

remoteStorage:
  driver: file
  bucket: ""
  region: ""
  prefix: media
  endpoint: http://minio.object-storage.svc.cluster.local:9000
  usePathStyle: true

cron:
  schedules:
    - name: main
      schedule: "* * * * *"
      command: ["/bin/bash", "-c", "php bin/magento cron:run"]

consumers:
  enabled: true
  list:
    - name: async-bulk
      queue: async.operations.all

hpa:
  web:
    enabled: true
    minReplicas: 2
    maxReplicas: 8
    cpu: 60
  php:
    enabled: true
    minReplicas: 2
    maxReplicas: 12
    cpu: 70
keda:
  rabbitmq:
    enabled: true
    queueName: async.operations.all
    scalingStrategy: cpu

ingress:
  enabled: true
  className: nginx
  annotations: {}
  hosts:
    - host: store.example.com
      paths:
      - path: /
        pathType: Prefix
  tls:
    - secretName: store-tls
      hosts:
        - store.example.com

storage:
  generated:
    enabled: true
    size: 2Gi
    accessMode: ReadWriteOnce
  varDi:
    enabled: true
    size: 2Gi
    accessMode: ReadWriteOnce
  pubStatic:
    enabled: true
    size: 4Gi
    accessMode: ReadWriteOnce
